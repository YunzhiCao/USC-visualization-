<script>
mapboxgl.accessToken = 'pk.eyJ1IjoicmljaGllNjE5IiwiYSI6ImNtN3YxY21sbDA2cm0ycnEycXVwa2NmemUifQ.VG0n1YWFUalWfyEvxQv4yg';

const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/streets-v12',
  center: [-118.285, 34.021],
  zoom: 16,
  pitch: 45,
  bearing: 0
});

function highlightDecade(start, end) {
  const maxHeight = 15;
  const minHeight = 6;
  const wallsHeight = ['case', ['all', ['>=', ['get', 'yearBuilt'], start], ['<', ['get', 'yearBuilt'], end]], maxHeight, minHeight];
  const roofsHeight = ['case', ['all', ['>=', ['get', 'yearBuilt'], start], ['<', ['get', 'yearBuilt'], end]], maxHeight + 0.1, minHeight + 0.1];

  map.setPaintProperty('usc-walls-layer', 'fill-extrusion-height', wallsHeight);
  map.setPaintProperty('usc-roofs-layer', 'fill-extrusion-height', roofsHeight);
}

map.on('load', () => {
  // 加载墙体 source
  map.addSource('usc-walls', {
    type: 'geojson',
    data: 'map.geojson'
  });

  // 加载屋顶 source（你新加的 map_roof.geojson）
  map.addSource('usc-roofs', {
    type: 'geojson',
    data: 'map_roof.geojson'
  });

  // 墙体图层
  map.addLayer({
    id: 'usc-walls-layer',
    type: 'fill-extrusion',
    source: 'usc-walls',
    paint: {
      'fill-extrusion-color': '#3A78C2',
      'fill-extrusion-height': [
        'case',
        ['all', ['>=', ['get', 'yearBuilt'], 1900], ['<', ['get', 'yearBuilt'], 2100]],
        15,
        6
      ],
      'fill-extrusion-base': 0,
      'fill-extrusion-opacity': 0.95
    }
  });

  // 屋顶图层（用不同的 source）
  map.addLayer({
    id: 'usc-roofs-layer',
    type: 'fill-extrusion',
    source: 'usc-roofs',
    paint: {
      'fill-extrusion-color': '#3A78C2',
      'fill-extrusion-height': [
        'case',
        ['all', ['>=', ['get', 'yearBuilt'], 1900], ['<', ['get', 'yearBuilt'], 2100]],
        15.1,
        6.1
      ],
      'fill-extrusion-base': 0,
      'fill-extrusion-opacity': 1
    }
  });
});
</script>



