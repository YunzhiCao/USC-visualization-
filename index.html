<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapbox + Deck.gl with Extrusion & Roof</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script src="https://unpkg.com/deck.gl@8.9.30/dist.min.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; height: 100vh; }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
      z-index: 1;
    }
    button {
      margin: 4px 0;
      width: 120px;
    }
  </style>
</head>
<body>
<div id="map"></div>
<div id="controls">
  <button onclick="highlightDecade(1970, 1980)">1970–1980</button>
  <button onclick="highlightDecade(2000, 2010)">2000–2010</button>
  <button onclick="highlightDecade(1900, 2100)">Reset</button>
</div>

<script>
const MAPBOX_TOKEN = 'pk.eyJ1IjoicmljaGllNjE5IiwiYSI6ImNtN3YxY21sbDA2cm0ycnEycXVwa2NmemUifQ.VG0n1YWFUalWfyEvxQv4yg';

const INITIAL_VIEW_STATE = {
  longitude: -118.285,
  latitude: 34.021,
  zoom: 16,
  pitch: 0,
  bearing: 0
};

let wallLayer, roofLayer, deckgl;

function getHeightExpression(start, end) {
  return feature => {
    const y = +feature.properties.yearBuilt;
    return (y >= start && y < end) ? 40 : 10;
  };
}

function highlightDecade(start, end) {
  const getHeight = getHeightExpression(start, end);
  wallLayer = wallLayer.clone({ getElevation: getHeight });
  roofLayer = roofLayer.clone({ getElevation: getHeight });
  deckgl.setProps({ layers: [wallLayer, roofLayer] });
}

fetch('map.geojson')
  .then(res => res.json())
  .then(data => {
    const features = data.features;
    const getHeight = getHeightExpression(1900, 2100);

    wallLayer = new deck.PolygonLayer({
      id: 'walls',
      data: features,
      getPolygon: d => d.geometry.coordinates[0],
      getElevation: getHeight,
      getFillColor: [58, 120, 194, 180],
      extruded: true,
      pickable: true,
      onClick: info => {
        const props = info.object.properties;
        alert(`${props.name}\nYear Built: ${props.yearBuilt}\nStyle: ${props.style}\nDesigner: ${props.designer}`);
      }
    });

    roofLayer = new deck.PolygonLayer({
      id: 'roof',
      data: features,
      getPolygon: d => d.geometry.coordinates[0],
      getElevation: getHeight,
      getFillColor: [58, 120, 194],
      extruded: false,
      pickable: false
    });

    deckgl = new deck.DeckGL({
      container: 'map',
      map: mapboxgl,
      mapboxAccessToken: MAPBOX_TOKEN,
      mapStyle: 'mapbox://styles/mapbox/streets-v12',
      initialViewState: INITIAL_VIEW_STATE,
      controller: true,
      layers: [wallLayer, roofLayer]
    });
  });
</script>
</body>
</html>










